<code-review>
# üß† Hybrid Code Review  
_A two-phase approach to balance precision and breadth_

---

## Pre-steps
1. Dont write any code.
2. run `git status` command to get the recent code changes
3. If there are no uncommitted changes, review the codebase state.
4. Perform a thorough code review using the following step-by-step guidelines.
5. Prefix each review with an emoji indicating a rating.
6. Score: Rate the code quality on a scale of 1-10, with 10 being best.
7. Provide Brief Summary and Recommendations.

---

## PHASE 1 ‚Äî üéØ Focused Local Review (Always Perform)

Review only the modified files and directly affected logic.

- [ ] üß† Functionality ‚Äî Does the change fulfill its purpose and handle edge cases?
- [ ] üßæ Readability ‚Äî Clear variable, function, and file naming? Easy to follow?
- [ ] üìê Consistency ‚Äî Coding style and architectural conventions followed?
- [ ] ‚ö°Ô∏è Performance ‚Äî Any potential slowdowns or unoptimized operations?
- [ ] üí° Best Practices ‚Äî DRY, modular, SOLID, minimal duplication?
- [ ] üß™ Test Coverage ‚Äî Are there adequate, meaningful tests? All tests passing?
- [ ] üßØ Error Handling ‚Äî Are errors handled gracefully without leaking info?

---

## SYSTEM REVIEW TRIGGER ‚Äî üïµÔ∏è Check If System-Wide Analysis Is Needed

Trigger Phase 2 if any of these are true:

- [ ] Affects shared modules, global state, or commonly reused logic  
- [ ] Changes public interfaces, exported APIs, or shared components  
- [ ] Introduces or modifies asynchronous logic or side effects  
- [ ] Appears to impact state across features or modules  
- [ ] Raises security, performance, or architectural concerns  

---

## PHASE 2 ‚Äî üîÅ System-Wide Review (Only If Triggered)

> ‚ö†Ô∏è Only assess each section below if it‚Äôs relevant to the code being changed.

- [ ] üîí Security  
    - Input sanitization?  
    - Data leakage, XSS, SQL injection, token misuse?

- [ ] üßµ Race Conditions  
    - Async safety?  
    - Parallel writes, shared state mutations?

- [ ] üß† Memory Leaks  
    - Cleanup of listeners, intervals, subscriptions, retained DOM references?

- [ ] üéûÔ∏è Animation Leaks  
    - UI transitions detached on unmount?  
    - Avoiding infinite or wasteful repaints?

- [ ] üîÑ State Management  
    - Predictable, well-scoped, normalized state logic?  
    - Avoids unnecessary re-renders or duplication?

- [ ] üìä Observability  
    - Logs meaningful and contextual?  
    - Monitoring/tracing in place for critical flows?

- [ ] üß¨ Schema/Type Validation  
    - Validates inputs/outputs with Zod, io-ts, or runtime guards?  
    - Are types used effectively at compile-time (e.g., TypeScript)?

- [ ] üèõÔ∏è Architecture  
    - Violates layering or introduces tight coupling?  
    - Shared responsibilities without separation of concerns?

---

## üß± Code Smells Checklist (Always Worth Surfacing)

- [ ] üîÅ Duplicated Code ‚Äî Can logic be abstracted or reused?
- [ ] üß¨ Long Methods ‚Äî Can complex logic be split into smaller functions?
- [ ] üß© Large/God Classes ‚Äî Too many responsibilities in one place?
- [ ] üßó Deep Nesting ‚Äî Favor guard clauses or early returns to flatten logic
- [ ] üîó Tight Coupling ‚Äî Is this module overly dependent on others?
- [ ] üíî Low Cohesion ‚Äî Unrelated behaviors grouped together?
- [ ] ü™ô Primitive Obsession ‚Äî Using raw types where objects/enums make sense?

---

## üóÇÔ∏è Issue Output Format

For each issue identified:

- File: `path/to/file.ts:42‚Äì45` or `path/to/file.ts:42`
- Severity: High / Medium / Low
- Issue: Brief description of the problem
- Why This Severity: Explain impact or potential harm
- Suggestion: Recommend a specific fix or approach
- Include the relevant lines of code illustrating the issue.
- Code Snippet Example (adapt to other languages if when necessary) 
```typescript
// File: utils/formatter.ts:42-45
export function formatDate(date: Date) {
  return date.toISOString().split('T')[0];
// Missing timezone offset handling
}
```

---

## üßÆ Severity Guidelines

- HIGH ‚Äî Must fix before release: crashes, regressions, data loss, security flaws, memory/race bugs
- MEDIUM ‚Äî Should fix soon: architectural drift, test gaps, performance concerns
- LOW ‚Äî Optional fix: style, naming, minor smells, doc improvements

---

## ‚úÖ Final Review Summary

- [ ] Emoji-prefixed scores for each applicable section
- [ ] Overall quality rating: `1‚Äì10`
- [ ] Blockers listed with severity
- [ ] Summary of feedback and top action items

---

## üéØ Next Steps Decision Framework

After completing the code review, use this framework to determine the appropriate next actions:

### üö¶ Action Decision Matrix

**Based on Overall Rating:**
- **9-10/10**: ‚úÖ **Ready to Merge** - Optional minor improvements only
- **7-8/10**: ‚ö†Ô∏è **Address Medium Issues** - Fix before merge, low issues optional  
- **5-6/10**: üîÑ **Requires Rework** - Address high and medium issues, consider architectural changes
- **1-4/10**: üõë **Major Revision Needed** - Significant rework required before re-review

### üìã Action Categories

#### üî• IMMEDIATE (Before Merge)
_Must address before code can be merged_

- [ ] **HIGH Severity Issues** - All high severity issues must be resolved
- [ ] **Breaking Changes** - Any changes that break existing functionality
- [ ] **Security Vulnerabilities** - Security-related issues require immediate attention
- [ ] **Test Failures** - All tests must pass
- [ ] **Memory/Race Conditions** - Critical system stability issues

#### ‚è∞ NEXT SPRINT (Within 1-2 Sprints)
_Should be addressed soon to prevent technical debt_

- [ ] **MEDIUM Severity Issues** - Architectural concerns and performance issues
- [ ] **Test Coverage Gaps** - Missing test coverage for critical functionality
- [ ] **Documentation Updates** - Code comments and documentation improvements
- [ ] **Consistency Issues** - Architectural or style inconsistencies

#### üîÆ FUTURE BACKLOG (Nice to Have)
_Improvements that can be scheduled for later_

- [ ] **LOW Severity Issues** - Style, naming, minor code smells
- [ ] **Optimization Opportunities** - Performance improvements without urgent need
- [ ] **Code Refactoring** - Non-critical structural improvements
- [ ] **Enhancement Ideas** - Suggestions for feature improvements

### üõ†Ô∏è Implementation Actions

#### For Code Author:
1. **Address Immediate Issues** - Fix all high severity and blocking issues
2. **Update Tests** - Ensure test coverage for any new functionality
3. **Update Documentation** - Revise comments and docs as needed
4. **Request Re-review** - If significant changes were made

#### For Reviewer:
1. **Verify Fixes** - Confirm that immediate issues have been resolved
2. **Approve or Request Changes** - Based on remaining issue severity
3. **Create Follow-up Tickets** - For next sprint and backlog items
4. **Update Team Knowledge** - Share insights or patterns discovered

### üìä Follow-up Template

```markdown
## üéØ Review Follow-up Actions

### ‚úÖ Immediate Actions (Required before merge):
- [ ] Fix security vulnerability in auth.ts:42
- [ ] Add error handling for async operations
- [ ] Resolve failing test in user-service.test.ts

### ‚è∞ Next Sprint Actions:
- [ ] JIRA-123: Improve test coverage for payment flow
- [ ] JIRA-124: Refactor user state management for consistency
- [ ] JIRA-125: Add performance monitoring to critical paths

### üîÆ Future Backlog:
- [ ] Consider extracting shared utilities to reduce duplication
- [ ] Explore alternative state management patterns
- [ ] Add comprehensive error logging throughout app

### üìù Notes:
- Author estimated 2-3 hours for immediate fixes
- Medium issues align with existing technical debt initiatives
- Consider scheduling architecture review session for consistency issues
```

---

## Output Example
```markdown
## üìä Overall Rating: 8.5/10 üü¢

### Brief Summary
The implementation successfully addresses screen dismissal and email verification feedback issues by introducing a robust toast notification system and improving authentication flow UX. The code demonstrates solid architecture with proper error handling, animation, and lifecycle management.

### üéØ Recommended Next Steps: ‚ö†Ô∏è Address Medium Issues
_Rating: 8.5/10 - Fix 2 medium severity issues before merge, low severity optional_

---

## üîç Detailed Review by Category

#### 1. üéØ Functionality - Score: 8/10 ‚úÖ
‚úÖ Strengths:
- Successfully addresses the core issue: signup modal not dismissing and lack of email verification feedback
- Proper conditional behavior: only dismiss modal on success, stay on screen for errors  
- Toast implementation provides clear user feedback for email verification  
- Router navigation correctly integrated with existing auth flow  

‚ö†Ô∏è Areas for Improvement:
- File: `app/(app)/sign-up.tsx:69-71` 
- Severity: Medium
- Issue: Hardcoded 300ms timeout for toast display  
- Why This Severity: Could create race conditions or timing issues on slower devices  
- Suggestion: Use navigation state listener or Promise.resolve().then() for more reliable timing
- Code Snippet:
    ~~~typescript
    // File: app/(app)/sign-up.tsx:69-71
    setTimeout(() => {
      showToast('Please check your email to verify your account', 'info');
      router.dismissAll();
    }, 300); // Hardcoded timeout - potential race condition
    ~~~

---

#### 2. üìñ Readability - Score: 8/10 ‚úÖ
‚úÖ Strengths:
- Clear, descriptive comments explaining modal dismissal behavior  
- Consistent import organization and naming conventions  
- Well-structured toast provider with clear interface  
- Good separation of concerns in toast component and context  

‚ö†Ô∏è Areas for Improvement:
- File: `components/ui/toast.tsx:52-60`
- Severity: Low
- Issue: Switch statement could benefit from a color mapping object  
- Why This Severity: Minor maintainability improvement, doesn't affect functionality  
- Suggestion: Extract color mapping to constants for easier maintenance
- Code Snippet:
    ~~~typescript
    // File: components/ui/toast.tsx:52-60
    switch (type) {
      case 'success': return 'bg-green-500';
      case 'error': return 'bg-red-500';
      case 'info': return 'bg-blue-500';
      default: return 'bg-gray-500';
    } // Consider extracting to TOAST_COLORS constant
    ~~~

---

#### 3. üîÑ Consistency - Score: 6/10 üü°
‚ö†Ô∏è Issues Identified:

- File: `app/(app)/sign-in.tsx:45` 
- Severity: Medium
- Issue: Sign-in doesn't provide user feedback like sign-up does  
- Why This Severity: Inconsistent user experience between auth flows  
- Suggestion: Add toast notification for successful sign-in or error feedback

- File: `app/(app)/welcome.tsx:16`
- Severity: Medium
- Issue: ToastContainer only added to welcome screen, not consistently across app  
- Why This Severity: Limits toast functionality to single screen, breaks expected behavior  
- Suggestion: Consider adding ToastContainer to main layout or implement global toast positioning
- Code Snippet:
    ~~~typescript
    // File: app/(app)/welcome.tsx:16
    <ToastContainer /> {/* Only on welcome screen - should be global */}
    ~~~

---

### üéØ Follow-up Actions Required

#### ‚úÖ Immediate Actions (Before merge):
- [ ] None - no high severity issues identified

#### ‚è∞ Next Sprint Actions:
- [ ] Fix hardcoded timeout in sign-up.tsx (Medium severity)
- [ ] Add consistent toast feedback to sign-in flow (Medium severity)  
- [ ] Move ToastContainer to global layout (Medium severity)

#### üîÆ Future Backlog:
- [ ] Refactor toast color mapping to constants (Low severity)
- [ ] Consider comprehensive toast notification strategy across app

### üìù Review Notes:
- Strong implementation overall with good architecture
- Focus on consistency improvements to enhance user experience
- No blocking issues, safe to merge after addressing medium severity items
```
</code-review>