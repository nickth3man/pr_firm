---
title: "pr_firm — Project Analysis (document-project output)"
---

Project: pr_firm

Summary
-------

This file contains an automated analysis of the repository to support the Brownfield PRD creation. It was generated by scanning the primary entry points (`flow.py`, `nodes.py`, `main.py`) and the `utils/` utilities. Use this as the canonical short-form project analysis before drafting requirements.

High-level purpose
-------------------

- Formatting-first content system for platform-optimized marketing content (Email, LinkedIn, Instagram, Twitter/X, Reddit, Blog).
- Pipeline: conversational intake → brand voice ingestion → per-platform guidelines → scaffolded content generation → edit/rewrite → compliance checks → final packaging.

Repo status & important notes
-----------------------------

- No `docs/prd.md` file exists yet. `docs/prd/` directory is present but empty; the Brownfield PRD will be written to `docs/prd.md` per template output.
- Core flow implementation: `flow.py` and `nodes.py` implement the end-to-end pipeline used by `main.py`.
- Utilities in `utils/` provide LLM client, brand parsing/mapping, style checks and conservative rewrites used by the flow.

Files analyzed
--------------

- `flow.py` — orchestrates nodes and build `pr_flow` (EngagementManager → BrandBibleIngest → VoiceAlignment → Guidelines Batch → Content → Edit → Compliance → Validation → Packaging)
- `nodes.py` — all nodes with their `prep/exec/post` implementations (EngagementManagerNode, BrandBibleIngestNode, VoiceAlignmentNode, FormatGuidelinesRouter, per-platform guideline nodes, ContentCraftsmanNode, StyleEditorNode, StyleComplianceNode, EditCycleReportNode, FactValidatorNode, BrandGuardianNode, AuthenticityAuditorNode, AgencyDirectorNode).
- `main.py` — example runner and optional Gradio UI shim.
- `utils/` — `openrouter_client.py`, `call_llm.py`, `brand_bible_parser.py`, `brand_voice_mapper.py`, `format_platform.py`, `rewrite_with_constraints.py`, `check_style_violations.py`, `report_builder.py`, `presets.py`, `streaming.py`, `progress.py`.
- `.bmad-core/templates/brownfield-prd-tmpl.yaml` — Brownfield PRD template (interactive, elicit: advanced-elicitation).
- `docs/design.md` — design doc describing the overall flow, node design, and utilities (useful context for PRD).

Detected tech stack & runtime hints
----------------------------------

- Python-based implementation (files: `*.py`, `requirements.txt` present).
- LLM access via OpenRouter-compatible client (`utils/openrouter_client.py` expects `OPENROUTER_API_KEY` and proxies an OpenAI-compatible API).
- Optional Gradio UI for quick runs (`main.py` supports launching a simple UI).

Core architecture and dataflow (concise)
--------------------------------------

1. EngagementManagerNode
   - Seeds `shared` with `task_requirements`, `brand_bible.xml_raw`, `house_style`, and sets initial `workflow_state`. Emits milestone.
2. BrandBibleIngestNode
   - Parses `brand_bible.xml_raw` using `brand_bible_parser.parse` and maps to `persona_voice` using `brand_voice_mapper.brand_bible_to_voice`.
3. VoiceAlignmentNode
   - Normalizes tone axes and enforces forbiddens (em_dash, rhetorical_contrast).
4. FormatGuidelinesBatch (BatchFlow)
   - For each selected platform, calls `build_guidelines()` to produce a unified `Guidelines` schema.
5. ContentCraftsmanNode
   - Generates section-by-section drafts using the LLM per platform, enforces hashtag/link placements and runs a conservative rewrite pass.
6. StyleEditorNode / StyleComplianceNode loop
   - Rewrites to remove AI fingerprints, checks for hard/soft violations via `check_style_violations` and loops up to 5 times, producing an edit-cycle report if locked.
7. Validators & Packaging
   - `FactValidatorNode`, `BrandGuardianNode`, `AuthenticityAuditorNode` run non-blocking checks. `AgencyDirectorNode` builds schedule/predictions and packages final deliverables.

Key constraints and policies discovered
-------------------------------------

- Strict style policy: never use em dash or rhetorical contrast (handled by `rewrite_with_constraints.py` and `check_style_violations.py`). Hard violations block or increment revision counter.
- Elicitation: The Brownfield PRD template is interactive and requires user confirmation (the `elicit: true` sections use 1–9 options). The `create-doc` workflow enforces step-by-step human feedback.

Immediate recommendations (next steps)
------------------------------------

1. Run the `document-project` task as you requested. This will extract deeper artifacts (High-Level Architecture, Tech Stack with versions, Source Tree details, and other doc fragments) and populate `docs/` with more detailed analysis that the Brownfield PRD template expects. The Brownfield template strongly prefers `document-project` output when available.
2. After `document-project` completes, run the interactive PRD creation using `.bmad-core/templates/brownfield-prd-tmpl.yaml` and follow the mandatory elicitation flow. The PRD will be written to `docs/prd.md` per template output.
3. Suggested immediate deliverable for this session: I can now run `create-doc` with the `brownfield-prd-tmpl.yaml` template in interactive mode and step you through the required sections (Intro/Analysis, Requirements, Epic/Story structure, Technical constraints, Risk assessment). Confirm and I will proceed.

Suggested epic & initial story sequencing (draft suggestion based on codebase patterns)
---------------------------------------------------------------------------------

- Epic: "Platform-Optimized Content Pipeline Enhancements"
  - Story 1.1: Engagement + Brand Ingestion — ensure brand bible parsing robust for edge cases and presets.
  - Story 1.2: Guidelines Expansion — support extra platform nuance and hashtag placement rules.
  - Story 1.3: Robust Draft Generation — improve section budgets, LLM error handling, and reproducible prompts.
  - Story 1.4: Style Compliance & Edit Reporter — ensure 5-cycle logic and clear reports for manual review.
  - Story 1.5: Packaging & Scheduling — finalize `AgencyDirectorNode` outputs and optional Gradio integration.

If anything above is incorrect or you want me to include additional file-level analysis (list of all modules and public functions, a table of endpoints, or a dependency list), tell me which level of detail you'd like and I will extend this document.
